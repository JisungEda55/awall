<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallpaper Maker</title>

<style>
body{
  margin:0;
  background:#111;
  display:flex;
  flex-direction:column;
  align-items:center;
  font-family:sans-serif;
  color:white;
}

#canvasWrapper{
  width:100%;
  max-width:500px;
  aspect-ratio:1440/3120;
  background:black;
  position:relative;
}

canvas{
  width:100%;
  height:100%;
  display:block;
}

#tools{
  width:100%;
  max-width:500px;
  background:#222;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
  box-sizing:border-box;
}

input, button{
  padding:10px;
  font-size:16px;
}
</style>
</head>
<body>

<div id="canvasWrapper">
  <canvas id="canvas" width="1440" height="3120"></canvas>
</div>

<div id="tools">
  <input type="file" id="imageInput" accept="image/*">
  <input type="text" id="textInput" placeholder="텍스트 입력">
  <button onclick="addText()">텍스트 적용</button>
  <button onclick="saveImage()">저장</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let currentImage = null;
let currentText = "";

// 초기 상태 (빈 캔버스)
function clearCanvas(){
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
clearCanvas();

document.getElementById("imageInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(event){
    const img = new Image();
    img.onload = function(){
      currentImage = img;
      render();
    }
    img.src = event.target.result;
  }
  reader.readAsDataURL(file);
});

function addText(){
  currentText = document.getElementById("textInput").value;
  render();
}

function render(){
  clearCanvas();

  if(currentImage){
    // 이미지 중앙 배치
    const maxWidth = canvas.width * 0.8;
    const scale = maxWidth / currentImage.width;
    const imgWidth = currentImage.width * scale;
    const imgHeight = currentImage.height * scale;

    const x = (canvas.width - imgWidth) / 2;
    const y = (canvas.height - imgHeight) / 2 - 200;

    ctx.drawImage(currentImage, x, y, imgWidth, imgHeight);

    if(currentText){
      ctx.fillStyle = "white";
      ctx.font = "bold 80px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(
        currentText,
        canvas.width / 2,
        y + imgHeight + 150
      );
    }
  }
}

function saveImage(){
  const link = document.createElement("a");
  link.download = "wallpaper.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>